function Loader(){this.isStarted=!1,this.events={},this.queue={},this.loading={},this.loaded={},this.failed={}}Loader.prototype.isExists=function(t){return t in this.queue||t in this.loading||t in this.loaded},Loader.prototype.getCountQueue=function(){return Object.keys(this.queue).length},Loader.prototype.getCountLoading=function(){return Object.keys(this.loading).length},Loader.prototype.getCountLoaded=function(){return Object.keys(this.loaded).length},Loader.prototype.getCountFailed=function(){return Object.keys(this.failed).length},Loader.prototype.isDependencyLoaded=function(t){if(t)if(t.length){for(var e=0;e<t.length;e++)if(!(t[e]in this.loaded))return!1}else if(!(t in this.loaded))return!1;return!0},Loader.prototype.add=function(t,e){var o=this;if(t instanceof Array)for(var n=0;n<t.length;n++)this.add(t[n],e);else{var i=e||{};this.isExists(t.name)?t.onloaded&&(t.name in this.loaded?t.onloaded(this.loaded[t.name].data):this.on("loaded",function(e){e.name===t.name&&t.onloaded(o.loaded[t.name].data)})):(i.prefix&&(t.src=i.prefix+t.src),this.queue[t.name]=t,this.emmit("added",[t]),this.progress(),this.isStarted&&this.loadNext())}},Loader.prototype.removeListener=Loader.prototype.off=function(t,e){for(var o=0;o<this.events[t].length;o++)if(this.events[t][o].listener==e)return void this.events[t].splice(o,1)},Loader.prototype.on=function(t,e){this.events[t]=this.events[t]||[],this.events[t].push({listener:e,once:!1})},Loader.prototype.once=function(t,e){this.events[t]=this.events[t]||[],this.events[t].push({listener:e,once:!0})},Loader.prototype.emmit=Loader.prototype.trigger=function(t,e){if(this.events[t]&&this.events[t].length>0){for(var o=this.events[t],n=[],i=[],a=0;a<o.length;a++)i.push(o[a].listener),o[a].once||n.push(o[a]);for(this.events[t]=n,a=0;a<i.length;a++)i[a].apply(i[a],e)}},Loader.prototype.start=function(){this.isStarted=!0,this.emmit("start",[this.queue]),this.progress(),this.loadNext()},Loader.prototype.stop=function(){this.isStarted=!1,this.emmit("stop",[])},Loader.prototype.loadNext=function(){for(var t in this.queue)this.isDependencyLoaded(this.queue[t].dep)&&this.startLoading(t)},Loader.prototype._onLoaded=function(t){var e=this.loading[t];this.loaded[e.name]=e,delete this.loading[t],this.emmit("loaded",[e]),this.progress()},Loader.prototype._onLoadFail=function(t){var e=this.loading[t];this.failed[e.name]=e,delete this.loading[t],this.emmit("failed",[e]),this.progress()},Loader.prototype.progress=function(){this.emmit("progress",[this.getCountQueue(),this.getCountLoading(),this.getCountLoaded(),this.getCountFailed()]),this.getCountQueue()+this.getCountLoading()===0?this.emmit("complete",[this.loaded,this.failed]):this.isStarted&&this.loadNext()},Loader.prototype.startLoading=function(t){var e=this.queue[t];this.loading[t]=e,delete this.queue[t];var o=this;this.emmit("loading",[e]),"js"==e.type&&this.loadJS(e.src,function(){o._onLoaded(e.name)},function(){o._onLoadFail(e.name)}),"json"==e.type&&this.loadJSON(e.src,function(t){e.data=t,e.onloaded instanceof Function&&e.onloaded(t),o._onLoaded(e.name)},function(){o._onLoadFail(e.name)}),"css"==e.type&&this.loadCSS(e.src,function(){o._onLoaded(e.name)},function(){o._onLoadFail(e.name)}),"data"==e.type&&this.loadData(e.src,function(t){e.data=t,e.onloaded instanceof Function&&e.onloaded(t),o._onLoaded(e.name)},function(){o._onLoadFail(e.name)})},Loader.prototype.loadData=function(t,e,o){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?e&&e(n.responseText):o&&o(n))},n.open("GET",t,!0),n.send()},Loader.prototype.loadJSON=function(t,e,o){var n=new XMLHttpRequest;n.onreadystatechange=function(){n.readyState===XMLHttpRequest.DONE&&(200===n.status?e&&e(JSON.parse(n.responseText)):o&&o(n))},n.open("GET",t,!0),n.send()},Loader.prototype.loadJS=function(t,e,o){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",t),n.onload=e,n.onerror=o,document.head.appendChild(n)},Loader.prototype.loadCSS=function(t,e,o){var n=document.createElement("link");n.setAttribute("rel","stylesheet"),n.setAttribute("href",t),n.onload=e,n.onerror=o,document.head.appendChild(n)},"undefined"!=typeof module&&(module.exports=Loader);