/*
 * jQuery ui dropppable Plugin
 * https://github.com/maxazan/jquery-ui-droppable-iframe
 *
 * Copyright 2015, Pomazan Maksym
 * Licensed under the MIT licenses.
 */
!function(t){var e=t.ui.ddmanager.prepareOffsets;t.ui.ddmanager.prepareOffsets=function(o){e.apply(this,arguments);for(var r,i=t.ui.ddmanager.droppables[o.options.scope]||[],l=0;l<i.length;l++)if((r=i[l].document[0])!==document){var a=t((r.defaultView||r.parentWindow).frameElement),p=a.offset(),n=i[l].element,s={top:a.contents().scrollTop(),left:a.contents().scrollLeft()};s.right=s.left+a.width(),s.bottom=s.top+a.height();var f=n.offset();if(f.right=f.left+n.outerWidth(),f.bottom=f.top+n.outerHeight(),s.right<f.left||s.left>f.right||s.bottom<f.top||s.top>f.bottom){i[l].proportions().height=0;continue}var c=f.top-a.contents().scrollTop();c=0>c?0:c;var g=f.left-a.contents().scrollLeft();g=0>g?0:g;var d=f.top+n.height()-a.contents().scrollTop();d=d>a.height()?a.height():d;var h=f.left+n.width()-a.contents().scrollLeft();h=h>a.width()?a.width():h,i[l].offset.top=p.top+c,i[l].offset.left=p.left+g,i[l].proportions({width:h-g,height:d-c})}},t.ui.plugin.add("draggable","iframeScroll",{drag:function(e,o,r){var i=r.options,l=i.iframeFix===!0?"iframe":i.iframeFix;r.document.find(l).each(function(){var o,l=!1,a=t(this),p=a.offset();p.width=a.width(),p.height=a.height(),p.left<e.pageX&&e.pageX<p.left+p.width&&p.top<e.pageY&&e.pageY<p.top+i.scrollSensitivity&&(o=a.contents(),l=o.scrollTop(o.scrollTop()-i.scrollSpeed)),p.left<e.pageX&&e.pageX<p.left+p.width&&p.top+p.height-i.scrollSensitivity<e.pageY&&e.pageY<p.top+p.height&&(o=a.contents(),l=o.scrollTop(o.scrollTop()+i.scrollSpeed)),p.left<e.pageX&&e.pageX<p.left+i.scrollSensitivity&&p.top<e.pageY&&e.pageY<p.top+p.height&&(o=a.contents(),l=o.scrollLeft(o.scrollLeft()-i.scrollSpeed)),p.left+p.width-i.scrollSensitivity<e.pageX&&e.pageX<p.left+p.width&&p.top<e.pageY&&e.pageY<p.top+p.height&&(o=a.contents(),l=o.scrollLeft(o.scrollLeft()+i.scrollSpeed)),l!==!1&&t.ui.ddmanager&&!i.dropBehaviour&&t.ui.ddmanager.prepareOffsets(r,e),clearTimeout(r.scrollTimer),r._mouseStarted&&(r.scrollTimer=setTimeout(function(){r._trigger("drag",e),t.ui.ddmanager&&t.ui.ddmanager.drag(r,e)},10))})},stop:function(t,e,o){clearInterval(o.scrollTimer)}})}(window.jQuery);